#app/static/swagger.yaml

swagger: "2.0"
info:
  title: "Mechanic Shop API"
  description: "This is a API to manage a Mechanic Shop"
  version: "1.0.0"
host: "127.0.0.1:5000"
schemes:
  - "http"
consumes:
  - "application/json"
produces:
  - "application/json"

securityDefinitions:
  bearerAuth:
    type: apiKey
    name: Authorization
    in: header

paths:
  /customers/login:
    post:
      tags:
        - customers
      summary: "Login endpoint, (generates token)"
      description: "Validates customer credentials, generates and return a customer specific token."
      parameters:
        - in: "body"
          name: "body"
          description: "Login Credentials"
          required: true
          schema:
            $ref: "#/definitions/LoginCredentials"
      responses:
        200:
          description: "Login successful"
          schema:
            $ref: "#/definitions/LoginResponse"
          examples:
            application/json:
              {
                "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
                "message": "Login successful",
                "status": "success",
              }

  /customers:
    post:
      tags:
        - customers
      summary: "Endpoint to create/register a new customer."
      description: "Endpoint to create a new customer in our Mechanic Shop system, emails must be unique."
      parameters:
        - in: "body"
          name: "body"
          description: "Information required to create a new Customer."
          required: true
          schema:
            $ref: "#/definitions/CreateCustomerPayload"
      responses:
        201:
          description: "Successful Customer Creation"
          schema:
            $ref: "#/definitions/CreateCustomerResponse"
          examples:
            application/json:
              id: 1
              name: "John Doe"
              email: "johnd@email.com"
              phone: "555-0199"
              password: "password123"

    get:
      tags:
        - customers
      summary: "Returns all Customers"
      description: "Endpoint to retrieve a list of all customers."
      responses:
        200:
          description: "Retrieved Customers Successfully"
          schema:
            $ref: "#/definitions/AllCustomers"
          examples:
            application/json:
              - id: 1
                name: "John Doe"
                email: "johnd@email.com"
                phone: "555-0199"
                password: "password123"

    delete:
      tags:
        - customers
      summary: "Endpoint to delete a customer"
      description: "Endpoint to delete a customer. Requires token authentication; the customer must be logged in to delete their account."
      security:
        - bearerAuth: []
      responses:
        200:
          description: "Successfully Deleted customer"
          schema:
            $ref: "#/definitions/DeleteCustomerResponse"
          examples:
            application/json:
              message: "Customer id: 1 successfully deleted"

  /customers/{id}:
    get:
      tags:
        - customers
      summary: "Endpoint to get a single customer."
      description: "Endpoint to retrieve a specific customer by their ID."
      parameters:
        - name: "id"
          in: "path"
          description: "ID of the customer to retrieve"
          required: true
          type: "integer"
      responses:
        200:
          description: "Successfully retrieved customer"
          schema:
            $ref: "#/definitions/CustomerResponse"
          examples:
            application/json:
              id: 1
              name: "John Doe"
              email: "johnd@email.com"
              phone: "555-0199"
              password: "password123"

    put:
      tags:
        - customers
      summary: "Endpoint to update a customer."
      description: "Endpoint to update a customer."
      parameters:
        - name: "id"
          in: "path"
          description: "ID of the customer to update"
          required: true
          type: "integer"
        - in: "body"
          name: "body"
          description: "Information required to update a Customer."
          required: true
          schema:
            $ref: "#/definitions/UpdateCustomerPayload"
      responses:
        200:
          description: "Successfully Updated customer"
          schema:
            $ref: "#/definitions/UpdateCustomerResponse"
          examples:
            application/json:
              id: 1
              name: "John Updated"
              email: "john_new@email.com"
              phone: "555-9999"
              password: "newpassword123"

  /mechanics:
    post:
      tags:
        - mechanics
      summary: "Create a new Mechanic"
      description: "Endpoint to add a new mechanic to the shop."
      parameters:
        - in: "body"
          name: "body"
          description: "Mechanic Data"
          required: true
          schema:
            $ref: "#/definitions/MechanicPayload"
      responses:
        201:
          description: "Mechanic created successfully"
          schema:
            $ref: "#/definitions/MechanicResponse"

    get:
      tags:
        - mechanics
      summary: "Get all Mechanics"
      description: "Retrieve a list of all mechanics. (Cached for 60 seconds)"
      responses:
        200:
          description: "List of mechanics"
          schema:
            $ref: "#/definitions/MechanicList"

  /mechanics/{id}:
    get:
      tags:
        - mechanics
      summary: "Get a Mechanic"
      description: "Retrieve a specific mechanic by their ID."
      parameters:
        - name: "id"
          in: "path"
          required: true
          type: "integer"
      responses:
        200:
          description: "Mechanic details"
          schema:
            $ref: "#/definitions/MechanicResponse"

    put:
      tags:
        - mechanics
      summary: "Update a Mechanic"
      description: "Update details of an existing mechanic."
      parameters:
        - name: "id"
          in: "path"
          required: true
          type: "integer"
        - in: "body"
          name: "body"
          required: true
          schema:
            $ref: "#/definitions/MechanicPayload"
      responses:
        200:
          description: "Mechanic updated successfully"
          schema:
            $ref: "#/definitions/MechanicResponse"

    delete:
      tags:
        - mechanics
      summary: "Delete a Mechanic"
      description: "Remove a mechanic from the system."
      parameters:
        - name: "id"
          in: "path"
          required: true
          type: "integer"
      responses:
        200:
          description: "Mechanic deleted successfully"
          examples:
            application/json:
              message: "mechanic id: 1, deleted successfully"

  /mechanics/top:
    get:
      tags:
        - mechanics
      summary: "Top Mechanics"
      description: "Get a list of mechanics sorted by who has completed the most service tickets."
      responses:
        200:
          description: "Sorted list of mechanics"
          schema:
            $ref: "#/definitions/MechanicList"

  /mechanics/search:
    get:
      tags:
        - mechanics
      summary: "Search Mechanics"
      description: "Search for a mechanic by name."
      parameters:
        - name: "name"
          in: "query"
          description: "The name (or partial name) to search for."
          required: true
          type: "string"
      responses:
        200:
          description: "Search results"
          schema:
            $ref: "#/definitions/MechanicList"

  /service_tickets:
    post:
      tags:
        - service_tickets
      summary: "Create a Service Ticket"
      description: "Open a new service ticket for a customer."
      parameters:
        - in: "body"
          name: "body"
          description: "Ticket details"
          required: true
          schema:
            $ref: "#/definitions/ServiceTicketPayload"
      responses:
        201:
          description: "Ticket created successfully"
          schema:
            $ref: "#/definitions/ServiceTicketResponse"
          examples:
            application/json:
              id: 1
              VIN: "1FTZR14E15PA82831"
              customer_id: 3
              service_date: "2023-04-01"
              service_desc: "Engine oil change"

    get:
      tags:
        - service_tickets
      summary: "Get all Service Tickets"
      description: "Retrieve a list of all service tickets, including assigned mechanics and customers."
      responses:
        200:
          description: "List of service tickets"
          schema:
            $ref: "#/definitions/ServiceTicketList"

  /service_tickets/my-tickets:
    get:
      tags:
        - service_tickets
      summary: "Get My Tickets"
      description: "Retrieve tickets belonging to the logged-in customer."
      security:
        - bearerAuth: []
      responses:
        200:
          description: "List of user's tickets"
          schema:
            $ref: "#/definitions/ServiceTicketList"

  /service_tickets/{id}:
    put:
      tags:
        - service_tickets
      summary: "Edit Service Ticket (Batch)"
      description: "Update a ticket by adding or removing multiple mechanics at once."
      parameters:
        - name: "id"
          in: "path"
          required: true
          type: "integer"
        - in: "body"
          name: "body"
          required: true
          schema:
            $ref: "#/definitions/EditTicketPayload"
      responses:
        200:
          description: "Ticket updated successfully"
          schema:
            $ref: "#/definitions/ServiceTicketResponse"

  /service_tickets/{ticket_id}/assign-mechanic/{mechanic_id}:
    put:
      tags:
        - service_tickets
      summary: "Assign Mechanic"
      description: "Add a specific mechanic to a service ticket."
      parameters:
        - name: "ticket_id"
          in: "path"
          required: true
          type: "integer"
        - name: "mechanic_id"
          in: "path"
          required: true
          type: "integer"
      responses:
        200:
          description: "Mechanic assigned successfully"
          schema:
            $ref: "#/definitions/ServiceTicketResponse"

  /service_tickets/{ticket_id}/remove-mechanic/{mechanic_id}:
    put:
      tags:
        - service_tickets
      summary: "Remove Mechanic"
      description: "Remove a specific mechanic from a service ticket."
      parameters:
        - name: "ticket_id"
          in: "path"
          required: true
          type: "integer"
        - name: "mechanic_id"
          in: "path"
          required: true
          type: "integer"
      responses:
        200:
          description: "Mechanic removed successfully"
          schema:
            $ref: "#/definitions/ServiceTicketResponse"

  /service_tickets/{ticket_id}/add-part/{part_id}:
    post:
      tags:
        - service_tickets
      summary: "Add Part to Ticket"
      description: "Associate a specific inventory part with a service ticket."
      parameters:
        - name: "ticket_id"
          in: "path"
          required: true
          type: "integer"
        - name: "part_id"
          in: "path"
          required: true
          type: "integer"
      responses:
        200:
          description: "Part added to ticket successfully"
          schema:
            type: "object"
            properties:
              message:
                type: "string"
              service_ticket_id:
                type: "integer"
              part_added:
                $ref: "#/definitions/InventoryResponse"

  /inventory:
    post:
      tags:
        - inventory
      summary: "Create Inventory Part"
      description: "Add a new part to the inventory."
      parameters:
        - in: "body"
          name: "body"
          description: "Part Details"
          required: true
          schema:
            $ref: "#/definitions/InventoryPayload"
      responses:
        201:
          description: "Part created successfully"
          schema:
            $ref: "#/definitions/InventoryResponse"

    get:
      tags:
        - inventory
      summary: "Get all Parts"
      description: "Retrieve a list of all inventory parts."
      responses:
        200:
          description: "List of parts"
          schema:
            $ref: "#/definitions/InventoryList"

  /inventory/{id}:
    get:
      tags:
        - inventory
      summary: "Get a Part"
      description: "Retrieve a specific part by ID."
      parameters:
        - name: "id"
          in: "path"
          required: true
          type: "integer"
      responses:
        200:
          description: "Part details"
          schema:
            $ref: "#/definitions/InventoryResponse"

    put:
      tags:
        - inventory
      summary: "Update a Part"
      description: "Update details of an existing part."
      parameters:
        - name: "id"
          in: "path"
          required: true
          type: "integer"
        - in: "body"
          name: "body"
          required: true
          schema:
            $ref: "#/definitions/InventoryPayload"
      responses:
        200:
          description: "Part updated successfully"
          schema:
            $ref: "#/definitions/InventoryResponse"

    delete:
      tags:
        - inventory
      summary: "Delete a Part"
      description: "Remove a part from inventory."
      parameters:
        - name: "id"
          in: "path"
          required: true
          type: "integer"
      responses:
        200:
          description: "Part deleted successfully"
          examples:
            application/json:
              message: "Part id: 1 deleted successfully"

definitions:
  LoginCredentials:
    type: "object"
    properties:
      email:
        type: "string"
      password:
        type: "string"
    required:
      - email
      - password

  LoginResponse:
    type: "object"
    properties:
      token:
        type: "string"
      message:
        type: "string"
      status:
        type: "string"

  CreateCustomerPayload:
    type: "object"
    properties:
      name:
        type: "string"
      email:
        type: "string"
      phone:
        type: "string"
      password:
        type: "string"
    required:
      - name
      - email
      - phone
      - password

  CreateCustomerResponse:
    type: "object"
    properties:
      id:
        type: "integer"
      name:
        type: "string"
      email:
        type: "string"
      phone:
        type: "string"
      password:
        type: "string"

  AllCustomers:
    type: "array"
    items:
      type: "object"
      properties:
        id:
          type: "integer"
        name:
          type: "string"
        email:
          type: "string"
        phone:
          type: "string"
        password:
          type: "string"

  UpdateCustomerPayload:
    type: "object"
    properties:
      name:
        type: "string"
      email:
        type: "string"
      phone:
        type: "string"
      password:
        type: "string"
    required:
      - name
      - email
      - phone
      - password

  CustomerResponse:
    type: "object"
    properties:
      id:
        type: "integer"
      name:
        type: "string"
      email:
        type: "string"
      phone:
        type: "string"
      password:
        type: "string"

  UpdateCustomerResponse:
    type: "object"
    properties:
      id:
        type: "integer"
      name:
        type: "string"
      email:
        type: "string"
      phone:
        type: "string"
      password:
        type: "string"

  DeleteCustomerResponse:
    type: "object"
    properties:
      message:
        type: "string"

  MechanicPayload:
    type: "object"
    properties:
      name:
        type: "string"
      email:
        type: "string"
      phone:
        type: "string"
      salary:
        type: "number"
        format: "float"
    required:
      - name
      - email
      - phone
      - salary

  MechanicResponse:
    type: "object"
    properties:
      id:
        type: "integer"
      name:
        type: "string"
      email:
        type: "string"
      phone:
        type: "string"
      salary:
        type: "number"
        format: "float"

  MechanicList:
    type: "array"
    items:
      $ref: "#/definitions/MechanicResponse"

  ServiceTicketPayload:
    type: "object"
    properties:
      VIN:
        type: "string"
      customer_id:
        type: "integer"
      service_date:
        type: "string"
        format: "date"
      service_desc:
        type: "string"
    required:
      - VIN
      - customer_id
      - service_date
      - service_desc

  ServiceTicketResponse:
    type: "object"
    properties:
      id:
        type: "integer"
      VIN:
        type: "string"
      service_date:
        type: "string"
        format: "date"
      service_desc:
        type: "string"
      customer:
        $ref: "#/definitions/CustomerResponse"
      mechanics:
        type: "array"
        items:
          $ref: "#/definitions/MechanicResponse"

  ServiceTicketList:
    type: "array"
    items:
      $ref: "#/definitions/ServiceTicketResponse"

  EditTicketPayload:
    type: "object"
    properties:
      add_mechanic_ids:
        type: "array"
        items:
          type: "integer"
      remove_mechanic_ids:
        type: "array"
        items:
          type: "integer"
    required:
      - add_mechanic_ids
      - remove_mechanic_ids

  InventoryPayload:
    type: "object"
    properties:
      name:
        type: "string"
      price:
        type: "number"
        format: "float"
    required:
      - name
      - price

  InventoryResponse:
    type: "object"
    properties:
      id:
        type: "integer"
      name:
        type: "string"
      price:
        type: "number"
        format: "float"

  InventoryList:
    type: "array"
    items:
      $ref: "#/definitions/InventoryResponse"