#app/static/swagger.yaml

swagger: "2.0"
info:
  title: "Library API"
  description: "This is a API to manage a Library"
  version: "1.0.0"
host: "127.0.0.1:5000"
schemes:
  - "http"
consumes:
  - "application/json"
produces:
  - "application/json"

securityDefinitions:
  bearerAuth:
    type: apiKey
    name: Authorization
    in: header

paths:
  /customers/login:
    post:
      tags:
        - customers
      summary: "Login endpoint, (generates token)"
      description: "Validates customer credentials, generates and return a customer specific token."
      parameters:
        - in: "body"
          name: "body"
          description: "Login Credentials"
          required: true
          schema:
            $ref: "#/definitions/LoginCredentials"
      responses:
        200:
          description: "Login successful"
          schema:
            $ref: "#/definitions/LoginResponse"
          examples:
            application/json:
              {
                "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
                "message": "Login successful",
                "status": "success",
              }

  /customers:
    post:
      tags:
        - customers
      summary: "Endpoint to create/register a new customer."
      description: "Endpoint to create a new customer in our Mechanic Shop system, emails must be unique."
      parameters:
        - in: "body"
          name: "body"
          description: "Information required to create a new Customer."
          required: true
          schema:
            $ref: "#/definitions/CreateCustomerPayload"
      responses:
        201:
          description: "Successful Customer Creation"
          schema:
            $ref: "#/definitions/CreateCustomerResponse"
          examples:
            application/json:
              id: 1
              name: "John Doe"
              email: "johnd@email.com"
              phone: "555-0199"
              password: "password123"

    get:
      tags:
        - customers
      summary: "Returns all Customers"
      description: "Endpoint to retrieve a list of all customers."
      responses:
        200:
          description: "Retrieved Customers Successfully"
          schema:
            $ref: "#/definitions/AllCustomers"
          examples:
            application/json:
              - id: 1
                name: "John Doe"
                email: "johnd@email.com"
                phone: "555-0199"
                password: "password123"

    delete:
      tags:
        - customers
      summary: "Endpoint to delete a customer"
      description: "Endpoint to delete a customer. Requires token authentication; the customer must be logged in to delete their account."
      security:
        - bearerAuth: []
      responses:
        200:
          description: "Successfully Deleted customer"
          schema:
            $ref: "#/definitions/DeleteCustomerResponse"
          examples:
            application/json:
              message: "Customer id: 1 successfully deleted"

  /customers/{id}:
    get:
      tags:
        - customers
      summary: "Endpoint to get a single customer."
      description: "Endpoint to retrieve a specific customer by their ID."
      parameters:
        - name: "id"
          in: "path"
          description: "ID of the customer to retrieve"
          required: true
          type: "integer"
      responses:
        200:
          description: "Successfully retrieved customer"
          schema:
            $ref: "#/definitions/CustomerResponse"
          examples:
            application/json:
              id: 1
              name: "John Doe"
              email: "johnd@email.com"
              phone: "555-0199"
              password: "password123"

    put:
      tags:
        - customers
      summary: "Endpoint to update a customer."
      description: "Endpoint to update a customer."
      parameters:
        - name: "id"
          in: "path"
          description: "ID of the customer to update"
          required: true
          type: "integer"
        - in: "body"
          name: "body"
          description: "Information required to update a Customer."
          required: true
          schema:
            $ref: "#/definitions/UpdateCustomerPayload"
      responses:
        200:
          description: "Successfully Updated customer"
          schema:
            $ref: "#/definitions/UpdateCustomerResponse"
          examples:
            application/json:
              id: 1
              name: "John Updated"
              email: "john_new@email.com"
              phone: "555-9999"
              password: "newpassword123"

  /mechanics:
    post:
      tags:
        - mechanics
      summary: "Create a new Mechanic"
      description: "Endpoint to add a new mechanic to the shop."
      parameters:
        - in: "body"
          name: "body"
          description: "Mechanic Data"
          required: true
          schema:
            $ref: "#/definitions/MechanicPayload"
      responses:
        201:
          description: "Mechanic created successfully"
          schema:
            $ref: "#/definitions/MechanicResponse"

    get:
      tags:
        - mechanics
      summary: "Get all Mechanics"
      description: "Retrieve a list of all mechanics. (Cached for 60 seconds)"
      responses:
        200:
          description: "List of mechanics"
          schema:
            $ref: "#/definitions/MechanicList"

  /mechanics/{id}:
    get:
      tags:
        - mechanics
      summary: "Get a Mechanic"
      description: "Retrieve a specific mechanic by their ID."
      parameters:
        - name: "id"
          in: "path"
          required: true
          type: "integer"
      responses:
        200:
          description: "Mechanic details"
          schema:
            $ref: "#/definitions/MechanicResponse"

    put:
      tags:
        - mechanics
      summary: "Update a Mechanic"
      description: "Update details of an existing mechanic."
      parameters:
        - name: "id"
          in: "path"
          required: true
          type: "integer"
        - in: "body"
          name: "body"
          required: true
          schema:
            $ref: "#/definitions/MechanicPayload"
      responses:
        200:
          description: "Mechanic updated successfully"
          schema:
            $ref: "#/definitions/MechanicResponse"

    delete:
      tags:
        - mechanics
      summary: "Delete a Mechanic"
      description: "Remove a mechanic from the system."
      parameters:
        - name: "id"
          in: "path"
          required: true
          type: "integer"
      responses:
        200:
          description: "Mechanic deleted successfully"
          examples:
            application/json:
              message: "mechanic id: 1, deleted successfully"

  /mechanics/top:
    get:
      tags:
        - mechanics
      summary: "Top Mechanics"
      description: "Get a list of mechanics sorted by who has completed the most service tickets."
      responses:
        200:
          description: "Sorted list of mechanics"
          schema:
            $ref: "#/definitions/MechanicList"

  /mechanics/search:
    get:
      tags:
        - mechanics
      summary: "Search Mechanics"
      description: "Search for a mechanic by name."
      parameters:
        - name: "name"
          in: "query"
          description: "The name (or partial name) to search for."
          required: true
          type: "string"
      responses:
        200:
          description: "Search results"
          schema:
            $ref: "#/definitions/MechanicList"

definitions:
  LoginCredentials:
    type: "object"
    properties:
      email:
        type: "string"
      password:
        type: "string"
    required:
      - email
      - password

  LoginResponse:
    type: "object"
    properties:
      token:
        type: "string"
      message:
        type: "string"
      status:
        type: "string"

  CreateCustomerPayload:
    type: "object"
    properties:
      name:
        type: "string"
      email:
        type: "string"
      phone:
        type: "string"
      password:
        type: "string"
    required:
      - name
      - email
      - phone
      - password

  CreateCustomerResponse:
    type: "object"
    properties:
      id:
        type: "integer"
      name:
        type: "string"
      email:
        type: "string"
      phone:
        type: "string"
      password:
        type: "string"

  AllCustomers:
    type: "array"
    items:
      type: "object"
      properties:
        id:
          type: "integer"
        name:
          type: "string"
        email:
          type: "string"
        phone:
          type: "string"
        password:
          type: "string"

  UpdateCustomerPayload:
    type: "object"
    properties:
      name:
        type: "string"
      email:
        type: "string"
      phone:
        type: "string"
      password:
        type: "string"
    required:
      - name
      - email
      - phone
      - password

  CustomerResponse:
    type: "object"
    properties:
      id:
        type: "integer"
      name:
        type: "string"
      email:
        type: "string"
      phone:
        type: "string"
      password:
        type: "string"

  UpdateCustomerResponse:
    type: "object"
    properties:
      id:
        type: "integer"
      name:
        type: "string"
      email:
        type: "string"
      phone:
        type: "string"
      password:
        type: "string"

  DeleteCustomerResponse:
    type: "object"
    properties:
      message:
        type: "string"

  MechanicPayload:
    type: "object"
    properties:
      name:
        type: "string"
      email:
        type: "string"
      phone:
        type: "string"
      salary:
        type: "number"
        format: "float"
    required:
      - name
      - email
      - phone
      - salary

  MechanicResponse:
    type: "object"
    properties:
      id:
        type: "integer"
      name:
        type: "string"
      email:
        type: "string"
      phone:
        type: "string"
      salary:
        type: "number"
        format: "float"

  MechanicList:
    type: "array"
    items:
      $ref: "#/definitions/MechanicResponse"
